DROP SCHEMA IF EXISTS chat CASCADE;
CREATE SCHEMA IF NOT EXISTS chat;

CREATE TABLE IF NOT EXISTS chat.user
(
    userId BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    login TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS chat.chatroom
(
    chatroomId BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    userId BIGINT NOT NULL REFERENCES chat.user(userId)
);

CREATE TABLE IF NOT EXISTS chat.message
(
    messageId BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    userId BIGINT NOT NULL REFERENCES chat.user(userId),
    chatroomId BIGINT NOT NULL REFERENCES chat.chatroom(chatroomId) ON DELETE CASCADE,
    text TEXT NOT NULL,
    date_time TIMESTAMP(6)
)
